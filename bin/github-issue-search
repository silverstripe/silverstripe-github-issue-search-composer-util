#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';


use Silverstripe\GithubIssueSearch\Util\UrlGenerator;

// Try to read from stdin
stream_set_blocking(STDIN, 0);
$lockfileStr = stream_get_contents(STDIN);

// Fall back to lockfile autodiscovery
if (!$lockfileStr) {
    // Relative to vendor/bin/ or bin/
    $lockfilePaths = [
        __DIR__ . '/../composer.lock',
        __DIR__ . '/../../composer.lock',
    ];
    foreach ($lockfilePaths as $lockfilePath) {
        if (file_exists($lockfilePath)) {
            $lockfileStr = file_get_contents($lockfilePath);
        }
    }
}

if (!$lockfileStr) {
    echo "Could not read a lockfile from stdin or find it in the project context" . PHP_EOL;
    exit(1);
}

$gen = new UrlGenerator();
echo $gen->generate($lockfileStr);